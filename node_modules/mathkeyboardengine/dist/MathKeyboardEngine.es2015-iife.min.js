"use strict";var mke=(()=>{var Z=Object.defineProperty;var Pe=Object.getOwnPropertyDescriptor;var ye=Object.getOwnPropertyNames;var Ne=Object.prototype.hasOwnProperty;var ve=(e,t)=>{for(var r in t)Z(e,r,{get:t[r],enumerable:!0})},be=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of ye(t))!Ne.call(e,n)&&n!==r&&Z(e,n,{get:()=>t[n],enumerable:!(o=Pe(t,n))||o.enumerable});return e};var Se=e=>be(Z({},"__esModule",{value:!0}),e);var Te={};ve(Te,{AscendingBranchingNode:()=>_,BranchingNode:()=>f,DecimalSeparatorNode:()=>V,DescendingBranchingNode:()=>$,DigitNode:()=>z,KeyboardMemory:()=>S,LatexConfiguration:()=>Y,LatexParserConfiguration:()=>F,LeafNode:()=>C,MatrixNode:()=>G,Placeholder:()=>c,RoundBracketsNode:()=>A,StandardBranchingNode:()=>y,StandardLeafNode:()=>L,TreeNode:()=>u,deleteLeft:()=>k,deleteRight:()=>X,deleteSelection:()=>ce,enterSelectionMode:()=>me,getEditModeLatex:()=>te,getViewModeLatex:()=>ne,inSelectionMode:()=>ue,insert:()=>a,insertWithEncapsulateCurrent:()=>q,insertWithEncapsulateSelection:()=>se,insertWithEncapsulateSelectionAndPrevious:()=>ae,leaveSelectionMode:()=>U,moveDown:()=>de,moveLeft:()=>pe,moveRight:()=>P,moveUp:()=>fe,parseLatex:()=>O,selectLeft:()=>he,selectRight:()=>ge});function te(e,t){return e.syntaxTreeRoot.getLatex(e,t)}function M(e){return e.toLowerCase()!=e.toUpperCase()}function oe(e){if(e.length==0)return!1;if(M(e[e.length-1]))for(let t=e.length-2;t>=0;t--){let r=e[t];if(!M(r))return r=="\\"}return!1}function D(...e){let t="";for(let r=0;r<e.length;r++){let o=e[r];oe(t)&&M(o[0])&&(t+=" "),t+=o}return t}var c=class{constructor(){this.parentNode=null;this.nodes=[]}getLatex(t,r){let o=()=>D(...this.nodes.map(n=>n.getLatex(t,r)));return t.inclusiveSelectionLeftBorder===this?D(r.selectionHightlightStart,o()):this===t.current?this.nodes.length==0?r.activePlaceholderLatex:D(r.activePlaceholderLatex,o()):this.nodes.length==0?r.passivePlaceholderLatex:o()}};var S=class{constructor(){this.syntaxTreeRoot=new c;this.current=this.syntaxTreeRoot;this.selectionDiff=null;this.inclusiveSelectionRightBorder=null;this.inclusiveSelectionLeftBorder=null}};var Le=new S;function ne(e,t){return(e instanceof S?e.syntaxTreeRoot:e).getLatex(Le,t)}function ie(e,t){let r=!1;for(let o=e.length-1;o>=0;o--){let n=e[o];if(!r){n===t&&(r=!0);continue}if(n.nodes.length>0)return n}return null}function b(e){return e.length==0?null:e[e.length-1]}function g(e,t){let r=e.indexOf(t);return r>0?e[r-1]:null}function T(e,t){let r=e.indexOf(t);e.splice(r,1)}var u=class{getLatex(t,r){let o=this.getLatexPart(t,r);return t.selectionDiff!=null&&t.selectionDiff!=0?(t.inclusiveSelectionLeftBorder===this&&(o=D(r.selectionHightlightStart,o)),t.inclusiveSelectionRightBorder===this&&(o=D(o,r.selectionHightlightEnd)),o):t.current===this?D(o,r.activePlaceholderLatex):o}};var f=class extends u{constructor(r){super();this.placeholders=r,this.placeholders.forEach(o=>{o.parentNode=this})}getMoveDownSuggestion(r){return null}getMoveUpSuggestion(r){return null}};function N(e){return e[e.length-1]}var C=class extends u{};var v=class extends C{};function Q(e,t,r){for(let o=e-1;o>=0;o--){let n=t[o];if(n instanceof v)T(t,n),r.nodes.unshift(n),n.parentPlaceholder=r;else break}}function I(e){let t=e.parentNode,r=t.parentPlaceholder.nodes.indexOf(t);t.parentPlaceholder.nodes.splice(r,1,...e.nodes);for(let o of e.nodes)o.parentPlaceholder=t.parentPlaceholder}function k(e){var t;if(e.current instanceof c){if(e.current.parentNode==null||e.current.nodes.length>0)return;{let r=ie(e.current.parentNode.placeholders,e.current);if(r)e.current.parentNode.placeholders.length==2&&e.current===e.current.parentNode.placeholders[1]&&e.current.nodes.length==0?(I(r),e.current=N(r.nodes)):(r.nodes.pop(),e.current=(t=b(r.nodes))!=null?t:r);else if(e.current.parentNode.placeholders.every(o=>o.nodes.length==0)){let o=e.current.parentNode.parentPlaceholder,n=g(o.nodes,e.current.parentNode);T(o.nodes,e.current.parentNode),e.current=n!=null?n:o}else if(e.current.parentNode.placeholders[0]===e.current&&e.current.nodes.length==0&&e.current.parentNode.placeholders.some(o=>o.nodes.length!=0)){let o=g(e.current.parentNode.parentPlaceholder.nodes,e.current.parentNode);if(o!=null)Be(o,e.current),e.current=N(e.current.nodes);else{let n=e.current.parentNode.placeholders.filter(i=>i.nodes.length!=0);if(n.length==1){let i=n[0].nodes,l=e.current.parentNode.parentPlaceholder,m=l.nodes.indexOf(e.current.parentNode);for(let B of i)B.parentPlaceholder=l;l.nodes.splice(m,1,...i),e.current=N(i)}}}}}else if(e.current instanceof f&&e.current.placeholders[0].nodes.length>0&&e.current.placeholders.slice(1).every(r=>r.nodes.length==0)){let r=e.current.placeholders[0];I(r),e.current=N(r.nodes)}else if(e.current instanceof f&&e.current.placeholders.some(r=>r.nodes.length>0))e.current=N(e.current.placeholders.flatMap(r=>r.nodes)),k(e);else{let r=g(e.current.parentPlaceholder.nodes,e.current);T(e.current.parentPlaceholder.nodes,e.current),e.current=r!=null?r:e.current.parentPlaceholder}}function Be(e,t){T(t.parentNode.parentPlaceholder.nodes,e),t.nodes.push(e);let r=e.parentPlaceholder;e.parentPlaceholder=t,e instanceof v&&Q(r.nodes.length-1,r.nodes,t)}function W(e,t){let r=e.indexOf(t);return r!=-1&&r<e.length-1?e[r+1]:null}function X(e){var t;if(e.current instanceof c)if(e.current.parentNode!=null&&e.current.parentNode.placeholders.every(r=>r.nodes.length==0)){let r=g(e.current.parentNode.parentPlaceholder.nodes,e.current.parentNode);T(e.current.parentNode.parentPlaceholder.nodes,e.current.parentNode),e.current=r!=null?r:e.current.parentNode.parentPlaceholder}else{let r=e.current.nodes;if(r.length>0)le(e,r[0]);else if(e.current.parentNode!=null){let o=e.current.parentNode,n=o.placeholders;if(n[0]==e.current&&n.length==2){let i=n[1];e.current=(t=g(o.parentPlaceholder.nodes,o))!=null?t:o.parentPlaceholder,I(i)}else for(let i=n.indexOf(e.current)+1;i<n.length;i++)if(n[i].nodes.length>0){e.current=n[i],X(e);return}}}else{let r=W(e.current.parentPlaceholder.nodes,e.current);r!=null&&le(e,r)}}function le(e,t){t instanceof f?t.placeholders.length==1&&t.placeholders[0].nodes.length>0?I(t.placeholders[0]):t.placeholders.length==2&&t.placeholders[0].nodes.length==0&&t.placeholders[1].nodes.length>0?I(t.placeholders[1]):(e.current=t.placeholders[0],X(e)):T(t.parentPlaceholder.nodes,t)}function U(e){e.selectionDiff=null,e.inclusiveSelectionRightBorder=null,e.inclusiveSelectionLeftBorder=null}function H(e){var r;if(e.selectionDiff==null)throw"Enter selection mode before calling this method.";if(e.selectionDiff==0)return U(e),[];let t=e.selectionDiff;if(e.current instanceof c)return U(e),e.current.nodes.splice(0,t);{let o=e.current.parentPlaceholder.nodes,n=o.indexOf(e.inclusiveSelectionLeftBorder);return e.current=(r=g(o,e.inclusiveSelectionLeftBorder))!=null?r:e.current.parentPlaceholder,U(e),o.splice(n,Me(t))}}function Me(e){return e<0?-e:e}function ce(e){H(e)}function P(e){var t;if(e.current instanceof c)if(e.current.nodes.length>0){let r=e.current.nodes[0];e.current=r instanceof f?r.placeholders[0]:r}else{if(e.current.parentNode==null)return;e.current=(t=W(e.current.parentNode.placeholders,e.current))!=null?t:e.current.parentNode}else{let r=W(e.current.parentPlaceholder.nodes,e.current);if(r!=null)e.current=r instanceof f?r.placeholders[0]:r;else{let o=e.current.parentPlaceholder.parentNode;if(o!=null){let n=W(o.placeholders,e.current.parentPlaceholder);e.current=n!=null?n:o}}}}function a(e,t){if(t instanceof Array)for(let r of t)a(e,r),e.current=r;else{if(e.current instanceof c)e.current.nodes.unshift(t),t.parentPlaceholder=e.current;else{let r=e.current.parentPlaceholder,o=r.nodes.indexOf(e.current);r.nodes.splice(o+1,0,t),t.parentPlaceholder=r}P(e)}}var y=class extends f{constructor(r,o,...n){let i=n.length+1,l=new Array;for(let m=0;m<i;m++)l.push(new c);super(l);this.before=r,this.then=o,this.rest=n}getLatexPart(r,o){let n=this.before+this.placeholders[0].getLatex(r,o)+this.then;for(let i=0;i<this.rest.length;i++)n+=this.placeholders[i+1].getLatex(r,o)+this.rest[i];return n}};var A=class extends y{constructor(t=String.raw`\left(`,r=String.raw`\right)`){super(t,r)}};function j(e,t){for(let r of e)r.parentPlaceholder=t,t.nodes.push(r)}function q(e,t,r){var n;let o=t.placeholders[0];if(e.current instanceof u){let i=e.current.parentPlaceholder.nodes,l=i.indexOf(e.current);i[l]=t,t.parentPlaceholder=e.current.parentPlaceholder,e.current instanceof A&&(r!=null&&r.deleteOuterRoundBracketsIfAny)?(j(e.current.placeholders[0].nodes,o),e.current=(n=W(t.placeholders,o))!=null?n:t):e.current instanceof v?(o.nodes.push(e.current),e.current.parentPlaceholder=o,Q(l,i,o),P(e)):(o.nodes.push(e.current),e.current.parentPlaceholder=o,P(e))}else a(e,t)}function se(e,t){let r=H(e);if(a(e,t),r.length>0){let o=t.placeholders[0];j(r,o),e.current=N(r),P(e)}}function ae(e,t){var n;if(t.placeholders.length<2)throw"Expected 2 placeholders.";let r=H(e),o=t.placeholders[1];j(r,o),q(e,t),e.current=(n=b(r))!=null?n:o}function de(e){var o;let t=e.current instanceof c?e.current:e.current.parentPlaceholder,r;for(;;){if(t.parentNode==null)return;r=t.parentNode;let n=r.getMoveDownSuggestion(t);if(n!=null){e.current=(o=b(n.nodes))!=null?o:n;return}t=r.parentPlaceholder}}function pe(e){var t,r,o;if(e.current instanceof c){if(e.current.parentNode==null)return;let n=g(e.current.parentNode.placeholders,e.current);if(n!==null)e.current=(t=b(n.nodes))!=null?t:n;else{let i=e.current.parentNode.parentPlaceholder,l=g(i.nodes,e.current.parentNode);e.current=l!=null?l:i}}else if(e.current instanceof f){let n=N(e.current.placeholders);e.current=(r=b(n.nodes))!=null?r:n}else e.current=(o=g(e.current.parentPlaceholder.nodes,e.current))!=null?o:e.current.parentPlaceholder}function fe(e){var o;let t=e.current instanceof c?e.current:e.current.parentPlaceholder,r;for(;;){if(t.parentNode==null)return;r=t.parentNode;let n=r.getMoveUpSuggestion(t);if(n!=null){e.current=(o=b(n.nodes))!=null?o:n;return}t=r.parentPlaceholder}}function E(e,t){if(e.selectionDiff=t,t==0)e.inclusiveSelectionLeftBorder=null,e.inclusiveSelectionRightBorder=null;else if(e.current instanceof c)e.inclusiveSelectionLeftBorder=e.current,e.inclusiveSelectionRightBorder=e.current.nodes[t-1];else{let r=e.current.parentPlaceholder.nodes,o=r.indexOf(e.current);if(t>0)e.inclusiveSelectionLeftBorder=r[o+1],e.inclusiveSelectionRightBorder=r[o+t];else{let n=o+t+1;if(n<0)throw"The TreeNode at index 0 of the current Placeholder is as far as you can go left if current is a TreeNode.";e.inclusiveSelectionLeftBorder=r[n],e.inclusiveSelectionRightBorder=e.current}}}function me(e){E(e,0)}function ue(e){return e.selectionDiff!=null}function he(e){var r;let t=(r=e.selectionDiff)!=null?r:0;e.current instanceof u&&e.current.parentPlaceholder.nodes.indexOf(e.current)+t>=0||e.current instanceof c&&t>0?E(e,t-1):e.inclusiveSelectionLeftBorder instanceof u&&e.inclusiveSelectionLeftBorder.parentPlaceholder.nodes.indexOf(e.inclusiveSelectionLeftBorder)==0&&e.inclusiveSelectionLeftBorder.parentPlaceholder.parentNode!=null&&(e.current=e.inclusiveSelectionLeftBorder.parentPlaceholder.parentNode,E(e,-1))}function ge(e){var r,o;let t=(r=e.selectionDiff)!=null?r:0;if(e.current instanceof c&&t<e.current.nodes.length||e.current instanceof u&&e.current.parentPlaceholder.nodes.indexOf(e.current)+t<e.current.parentPlaceholder.nodes.length-1)E(e,t+1);else if(e.inclusiveSelectionRightBorder instanceof u&&N(e.inclusiveSelectionRightBorder.parentPlaceholder.nodes)==e.inclusiveSelectionRightBorder&&e.inclusiveSelectionRightBorder.parentPlaceholder.parentNode!=null){let n=e.inclusiveSelectionRightBorder.parentPlaceholder.parentNode;e.current=(o=g(n.parentPlaceholder.nodes,n))!=null?o:n.parentPlaceholder,E(e,1)}}var F=class{constructor(){this.additionalDigits=null;this.decimalSeparatorMatchers=[".","{,}"];this.preferRoundBracketsNode=!0}};var _=class extends y{getMoveDownSuggestion(t){let r=this.placeholders.indexOf(t);return r>0?this.placeholders[r-1]:null}getMoveUpSuggestion(t){let r=this.placeholders.indexOf(t);return r<this.placeholders.length-1?this.placeholders[r+1]:null}};var V=class extends v{constructor(r="."){super();this.latex=typeof r=="string"?()=>r:r}getLatexPart(r,o){return this.latex()}};var $=class extends y{getMoveDownSuggestion(t){let r=this.placeholders.indexOf(t);return r<this.placeholders.length-1?this.placeholders[r+1]:null}getMoveUpSuggestion(t){let r=this.placeholders.indexOf(t);return r>0?this.placeholders[r-1]:null}};var z=class extends v{constructor(r){super();this.latex=r}getLatexPart(r,o){return this.latex}};var L=class extends C{constructor(r){super();this.latex=typeof r=="string"?()=>r:r}getLatexPart(r,o){return this.latex()}};function w(e,t,r){let o=e.slice(-1),n=r.slice(e.length),i=0;for(let l=0;l<n.length;l++){if(n.substring(l,l+t.length)==t){if(i==0)return{content:n.slice(0,l),rest:n.slice(l+t.length)};i--;continue}let m=["\\"+o,"\\"+t,String.raw`\left`+o,String.raw`\right`+t],B=n.slice(l);for(let s of m)if(B.length>=s.length&&B.startsWith(s)){l+=s.length;continue}n[l]==o&&i++}throw`A closing ${t} is missing.`}var G=class extends f{constructor(r,o,n){let i=[],l=[];for(let m=0;m<n;m++){let B=[];for(let s=0;s<o;s++){let h=new c;B.push(h),l.push(h)}i.push(B)}super(l);this.grid=i,this.matrixType=r,this.width=o}getLatexPart(r,o){let n=String.raw`\begin{${this.matrixType}}`;return n+=this.grid.map(i=>i.map(l=>l.getLatex(r,o)).join(" & ")).join(String.raw` \\ `),n+=String.raw`\end{${this.matrixType}}`,n}getMoveDownSuggestion(r){let{rowIndex:o,columnIndex:n}=this.getPositionOf(r);return o+1<this.grid.length?this.grid[o+1][n]:null}getMoveUpSuggestion(r){let{rowIndex:o,columnIndex:n}=this.getPositionOf(r);return o-1>=0?this.grid[o-1][n]:null}getPositionOf(r){let o=this.placeholders.indexOf(r);if(o==-1)throw"The provided Placeholder is not part of this MatrixNode.";let n=Math.floor(o/this.width),i=o-n*this.width;return{rowIndex:n,columnIndex:i}}};function O(e,t=new F){var n,i;if(e==null)return new S;let r=e.trim(),o=new S;for(;r!="";){if(r[0]==" "){r=r.trimStart();continue}let l=t.decimalSeparatorMatchers.find(s=>r.startsWith(s));if(l!=null){a(o,new V((n=t.preferredDecimalSeparator)!=null?n:l)),r=r.slice(l.length);continue}if(["1","2","3","4","5","6","7","8","9","0"].includes(r[0])||(i=t.additionalDigits)!=null&&i.includes(r[0])){a(o,new z(r[0])),r=r.slice(1);continue}let m=!1;if(r.startsWith(String.raw`\begin{`)){let s=w(String.raw`\begin{`,"}",r);if(!s.content.endsWith("matrix")&&!s.content.endsWith("cases"))throw String.raw`Expected a word ending with 'matrix' or 'cases' after '\begin{'.`;let d=s.rest.slice(0,s.rest.indexOf(String.raw`\end{${s.content}}`)).split(String.raw`\\`);a(o,new G(s.content,d[0].split("&").length,d.length));for(let x of d)for(let K of x.split("&")){let R=O(K,t).syntaxTreeRoot.nodes;a(o,R),P(o)}let p=String.raw`\end{${s.content}}`;r=r.slice(r.indexOf(p)+p.length);continue}if(t.preferRoundBracketsNode&&(r[0]=="("||r.startsWith(String.raw`\left(`))){let s=r[0]=="("?"(":String.raw`\left(`,h=r[0]=="("?")":String.raw`\right)`,d=new A(s,h);a(o,d);let p=w(s,h,r),x=O(p.content,t).syntaxTreeRoot.nodes;a(o,x),o.current=d,r=p.rest;continue}if(r.startsWith("\\")){for(let d of["\\left\\","\\right\\",String.raw`\left`,String.raw`\right`])if(r.startsWith(d)&&!M(r.slice(d.length)[0])){a(o,new L(d+r[d.length])),r=r.slice(d.length+1),m=!0;break}if(m)continue;let s=String.raw`\text{`;if(r.startsWith(s)){let d=w(s,"}",r),p=new y(s,"}");a(o,p);for(let x of d.content)a(o,new L(x));o.current=p,r=d.rest;continue}let h="\\";if(M(r[1])){for(let d=1;d<r.length;d++){let p=r[d];if(M(p))h+=p;else if(p=="{"||p=="["){let x=h+p,K=p=="{"?"}":"]",R=w(x,K,r),ee=O(R.content,t).syntaxTreeRoot.nodes;if(R.rest[0]=="{"){let J=new $(x,K+"{","}");a(o,J),a(o,ee),P(o);let re=w("{","}",R.rest),xe=O(re.content,t).syntaxTreeRoot.nodes;a(o,xe),o.current=J,r=re.rest}else{let J=new y(x,K);a(o,J),a(o,ee),o.current=J,r=R.rest}m=!0;break}else break}if(m)continue;a(o,new L(h)),r=r.slice(h.length)}else a(o,new L("\\"+r[1])),r=r.slice(2);continue}if(r.startsWith("_{")){let s="_{",d=w(s,"}",r);if(d.rest.startsWith("^{")){let p=new _(s,"}^{","}");a(o,p);let x=O(d.content,t).syntaxTreeRoot.nodes;a(o,x),P(o);let K=w("^{","}",d.rest),R=O(K.content,t).syntaxTreeRoot.nodes;a(o,R),o.current=p,r=K.rest;continue}}let B=[["^{",()=>new _("","^{","}")],["_{",()=>new $("","_{","}")]];for(let s of B){let h=s[0];if(r.startsWith(h)){let d=s[1]();q(o,d);let p=w(h,"}",r),x=O(p.content,t).syntaxTreeRoot.nodes;a(o,x),o.current=d,r=p.rest,m=!0;break}}m!=!0&&(a(o,new L(r[0])),r=r.slice(1))}return o}var Y=class{constructor(){this.activePlaceholderShape=String.raw`\blacksquare`;this.passivePlaceholderShape=String.raw`\square`;this.selectionHightlightStart=String.raw`\colorbox{#ADD8E6}{\(\displaystyle`;this.selectionHightlightEnd=String.raw`\)}`}get activePlaceholderLatex(){return this.activePlaceholderColor==null?this.activePlaceholderShape:String.raw`{\color{${this.activePlaceholderColor}}${this.activePlaceholderShape}}`}get passivePlaceholderLatex(){return this.passivePlaceholderColor==null?this.passivePlaceholderShape:String.raw`{\color{${this.passivePlaceholderColor}}${this.passivePlaceholderShape}}`}};return Se(Te);})();
